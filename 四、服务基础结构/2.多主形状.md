# 使用 多主

KeyDB现在在复制时支持多个主机。此模式通过以下配置行启用：

    multi-master yes
    
当KeyDB连接到多个主服务器时，其行为与传统复制不同：

    * 多次调用replicaof命令将导致添加额外的主服务器，而不是替换当前的主服务器
    * 与主数据库同步时，KeyDB不会删除其数据库
    * KeyDB将主数据库中的任何读/写操作与其自己的内部数据库合并
    * KeyDB将默认为最后一个操作wins

这意味着具有多个主控形状的副本将包含其所有主控形状的数据的超集。如果两个主控形状的值具有相同的键，则未定义将采用哪个键。
如果主机删除另一个主机上存在的key，则副本将不再包含该key的副本。

**这个功能仍然是实验性的，如果你尝试了，请告诉我们它是如何为你工作的。请注意您的性能，因为此功能有时会遇到流量风暴。**
**如果您只将2个实例设置为主实例，请使用活动复制，因为它比多主实例更稳定，并且经过测试可以处理高负载**

## 设置多主

多主设置与活动副本设置非常相似，但允许多个副本节点（所有主节点）。它允许您对所有在高负载下可以增加读取的实例进行读写，
并让您的其他主节点准备好进入一个失败场景。

使用多主机设置，可以使每个主机成为其他节点的副本。这可以接受许多拓扑，您可以对环形拓扑进行不同的变化，
或者使每个主节点都成为所有其他主节点的副本。如果不是所有连接都同步，请考虑故障情况，并确保一次中断不会导致其他连接丢失。

配置文件示例：

## 配置文件

实例A 配置文件:

    # assuming below parameters were set and IP address of this instance is 10.0.0.2
    port 6379
    requirepass mypassword123
    masterauth mypassword123
    # you will need to configure the following
    multi-master yes
    active-replica yes
    replicaof 10.0.0.3 6379
    replicaof 10.0.0.4 6379

实例B 配置文件:

    # assuming below parameters were set and IP address of this instance is 10.0.0.3
    port 6379
    requirepass mypassword123
    masterauth mypassword123
    # you will need to configure the following
    multi-master yes
    active-replica yes
    replicaof 10.0.0.2 6379
    replicaof 10.0.0.4 6379

实例C 配置文件:

    # assuming below parameters were set and IP address of this instance is 10.0.0.4
    port 6379
    requirepass mypassword123
    masterauth mypassword123
    # you will need to configure the following
    multi-master yes
    active-replica yes
    replicaof 10.0.0.2 6379
    replicaof 10.0.0.3 6379

您还可以将keydb-server附加到配置文件中 keydb-server --multi-master yes --active-replica yes --replicaof <ipaddress> <port> --replicaof
