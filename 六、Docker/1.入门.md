# Docker入门

## 有什么新鲜事吗？

KeyDB现在支持active-replica活动副本。此功能极大地简化了热备盘故障切换，并允许您在副本上分发写操作，而不只是一个主副本。
有关详细信息，请参见wiki页面。
最新的拉取（v0.9.3）将包含active-replica活动副本支持选项，默认情况下在redis.conf中禁用该选项。
如果您想尝试，请在每个wiki中启用该选项，并在下面使用您自己的配置文件运行docker 每个容器.

KeyDB现在支持ARM、ARM 64、x86-64。docker pull eqalpha/keydb 将从清单中提取正确的镜像。

如果您有兴趣从我们的github unstable生成最新的二进制文件，请查看我们的镜像以构建二进制文件（x86_64）"eqalpha/keydb-build-bin""

最新版本0.9.4中包括Multi-Master多主机支持和Active-Replica活动副本支持。这个功能仍然被认为是实验性的，但是试试让我们知道你的想法。
我们有一些其他非常酷的功能即将推出。如果您想加入我们的邮件列表以了解我们的最新版本和功能，
请访问我们的网站向我们发送一条消息以获得添加！

### 启动keydb实例

    docker run --name some-keydb -d eqalpha/keydb

### 从持久存储开始

    $ docker run --name some-keydb -d eqalpha/keydb keydb-server --appendonly yes

如果启用了持久性，则数据存储在卷/data中，该 --volumes-from some-volume-container一起使用 或 -v /docker/host/dir:/data (查看文档 docker volumes）一起使用。

### 从应用程序连接到它

    $ docker run --name some-app --link some-keydb:eqalpha/keydb -d application-that-uses-keydb

### 或通过keydb-cli连接(也可与redis-cli兼容)

    $ docker run -it --link some-keydb:eqalpha/keydb --rm eqalpha/keydb keydb-cli -h keydb -p 6379

您还可以获取容器的ip使用 docker inspect --format '{{ .NetworkSettings.IPAddress }}' mycontainername，然后运行以下命令：

    docker run -it --rm eqalpha/keydb keydb-cli -h <ipaddress-from-above> -p 6379
    
### 更新Docker镜像中使用的配置文件

如果要指定要运行的二进制文件（对于CMD）并更新其配置文件，请确保在更新后指定镜像中的配置文件位置（即在当前设置中启用active-replica）：

    $ docker run --name mykeydb -d eqalpha/keydb keydb-server /etc/keydb/redis.conf --active-replica yes

### 如果您想使用自己的配置文件

    $ docker run -v /path-to-config-file/redis.conf:/etc/keydb/redis.conf --name mykeydb -d eqalpha/keydb

如果使用自己的配置文件，请记住注释"bind 127.0.0.1""，将"protected mode"从"yes"更改为"no"。
如果要启用Active Replica活动副本支持，请取消注释"active-replica yes"。

您可以从我们的github页面中获取默认配置文件的副本

### 新配置选项

新功能带来新选项：

    server-threads N
    server-thread-affinity [true/false]
    scratch-file-path /tmp/
    active-replica yes

用于服务请求的线程数。这应该与网络硬件中可用的队列数有关，而不是与计算机上的内核数有关。
因为KeyDB使用自旋锁来减少延迟；使此值过高将降低性能。我们推荐在这里使用4。默认情况下，此镜像设置为3。

所有其他配置选项的行为与您预期的一样。您现有的配置文件应该继续工作不变。

有关 flash backed storge 或直接转储到AWS S3的更多选项，请查看我们的github页面

### KeyDB Flash支持

有关详细说明，请参见wiki (https://github.com/JohnSully/KeyDB/wiki/FLASH-Storage)

您需要使用BTRFS文件系统将一个目录装载到SSD/NVMe卷。然后您可以通过：

    $ docker run -it --name mykeydb --mount type=bind,target=/tmp/keydbflash,source=/path-to-btrfs-ssd-mount-location-you-made/ eqalpha/keydb:flash

### 尝试最新的:

如果您一直与KeyDB保持同步，并且希望在正式发布之前查看making中的特性，那么您可以使用不稳定的标签。
这将抓取最新版本(自动更新每天凌晨4点东部)。这些标签仅适用于x86-64（amd-64）。
用docker拉最新的镜像: docker pull eqalpha/keydb:unstable 或 闪存构建获取  docker pull eqalpha/keydb:unstable-flash

要定期更新被推送到github不稳定分支的更改和问题解决方案，请在github上关注我们。如需更多一般更新或保持联系，
请访问 https://eqalpha.us20.list-manage.com/subscribe/post?u=978f486c2f95589b24591a9cc&id=4ab9220500 发布KeyDB

